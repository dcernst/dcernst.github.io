"use strict";(self.webpackChunkWebComponents=self.webpackChunkWebComponents||[]).push([[168],{11168:(t,e,i)=>{i.r(e),i.d(e,{default:()=>o});var s=i(78673);class o extends s.A{constructor(t){super(t);var e=t.orig;this.origElem=e,this.divid=e.id,this.children=this.origElem.childNodes,this.optionList=[],this.optsArray=[],this.comment=!1,$(this.origElem).is("[data-comment]")&&(this.comment=!0),this.resultsViewer=$(e).data("results"),this.getQuestionText(),this.getOptionText(),this.renderPoll(),this.checkPollStorage(),this.caption="Poll",this.addCaption("runestone")}getQuestionText(){for(var t,e=0;e<this.children.length;e++)if("LI"==this.children[e].tagName){t=this.children[e];break}var i=t.outerHTML,s=$(this.origElem).html().split(i);this.question=s[0]}getOptionText(){for(var t=this,e=0;e<this.children.length;e++)"LI"==t.children[e].tagName&&t.optionList.push($(t.children[e]).html())}renderPoll(){this.containerDiv=document.createElement("div"),this.pollForm=document.createElement("form"),this.resultsDiv=document.createElement("div"),$(this.resultsDiv).addClass("poll-results"),this.containerDiv.id=this.divid,$(this.containerDiv).addClass(this.origElem.getAttribute("class")),$(this.pollForm).html(`<span style='font-size: Large'>${this.question}</span>`),$(this.pollForm).attr({id:this.divid+"_form",method:"get",action:"",onsubmit:"return false;"}),this.pollForm.appendChild(document.createElement("br"));for(var t=0;t<this.optionList.length;t++){var e=document.createElement("input"),i=this.divid+"_opt_"+t;$(e).attr({id:i,name:this.divid+"_group1",type:"radio",value:t}),$(e).click(this.submitPoll.bind(this));var s=document.createElement("div");$(s).html(this.optionList[t]),$(s).addClass("poll-option"),this.pollForm.appendChild(e),this.optsArray.push(e),this.pollForm.appendChild(s),this.pollForm.appendChild(document.createElement("br"))}this.comment&&this.renderTextField(),this.resultsDiv.id=this.divid+"_results",this.containerDiv.appendChild(this.pollForm),this.containerDiv.appendChild(this.resultsDiv),$(this.origElem).replaceWith(this.containerDiv),this.queueMathJax(this.containerDiv)}renderTextField(){this.textfield=document.createElement("input"),this.textfield.type="text",$(this.textfield).addClass("form-control"),this.textfield.style.width="300px",this.textfield.name=this.divid+"_comment",this.textfield.placeholder="Any comments?",this.pollForm.appendChild(this.textfield),this.pollForm.appendChild(document.createElement("br"))}submitPoll(){for(var t=null,e=0;e<this.optsArray.length;e++)if(this.optsArray[e].checked){t=this.optsArray[e].value;break}if(null!==t){var i="";this.comment&&(i=this.textfield.value);var s={event:"poll",act:""!==i?t+":"+i:t,div_id:this.divid};if(this.logBookEvent(s),localStorage.setItem(this.divid,"true"),document.getElementById(`${this.divid}_sent`)?$(`#${this.divid}_sent`).html(`<strong>\n                ${eBookConfig.useRunestoneServices?"Only Your last reponse is recorded":"Thanks, your answers are not recorded"}\n                </strong>`):$(this.pollForm).append(`<span id=${this.divid}_sent><strong>\n                ${eBookConfig.useRunestoneServices?"Thanks, your response has been recorded":"Thanks, your answers are not recorded"}</strong></span>`),"all"===this.resultsViewer){var o={};o.div_id=this.divid,o.course=eBookConfig.course,jQuery.get(`${eBookConfig.new_server_prefix}/assessment/getpollresults`,o,this.showPollResults)}}}showPollResults(t){var e=(t=t.detail).total,i=t.opt_counts,s=(t.div_id,t.my_vote);if(s>-1&&(this.optsArray[s].checked="checked"),"all"===this.resultsViewer&&localStorage.getItem("true"===this.divid)||eBookConfig.isInstructor){$(this.resultsDiv).html(`<b>Results:</b> ${e} responses <br><br>`);var o=$(document.createElement("div"));$(o).addClass("results-container");for(var r=0;r<this.optionList.length;r++){var n,l;i[r]>0?l=(n=i[r])/e*100:(n=0,l=0);var d=n+" ("+Math.round(10*l)/10+"%)",a=$(l>10?`<div class="progresscounter">${r+1}. </div><div class='progress'><div class='progress-bar progress-bar-success'style="width: ${l}%; min-width: 2em;"><span class='poll-text'>`+d+"</span></div></div>":`<div class="progresscounter">${r+1}. </div><div class='progress'><div class='progress-bar progress-bar-success'style="width: ${l}%; min-width: 2em;"></div><span class='poll-text' style='margin: 0 0 0 10px;'>`+d+"</span></div>");o.append(a)}$(this.resultsDiv).append(o)}this.indicate_component_ready()}disableOptions(){}checkPollStorage(){if(localStorage.length>0){var t={};t.div_id=this.divid,t.course=eBookConfig.course,jQuery.get(`${eBookConfig.new_server_prefix}/assessment/getpollresults`,t,this.showPollResults.bind(this)).fail(this.indicate_component_ready.bind(this))}else this.indicate_component_ready()}}$(document).on("runestone:login-complete",(function(){$("[data-component=poll]").each((function(t){try{window.componentMap[this.id]=new o({orig:this})}catch(t){console.log(`Error rendering Poll Problem ${this.id}\n                         Details: ${t}`),console.log(t.stack)}}))})),void 0===window.component_factory&&(window.component_factory={}),window.component_factory.poll=function(t){return new o(t)}}}]);
//# sourceMappingURL=168.js.map